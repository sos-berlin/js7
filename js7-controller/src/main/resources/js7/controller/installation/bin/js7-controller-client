#!/usr/bin/env bash
set -euo pipefail

JOBSCHEDULER_HOME="$(cd "${0%/*}/../bin/.." && pwd)"
export JOBSCHEDULER_HOME
. "$JOBSCHEDULER_HOME/bin/internal/set-context.sh"
declare classpathString java

httpPort=4444
args=()
javaOptions=(
  -Xms50m
  -Xmx100m
  -XX:MaxJavaStackTraceDepth=999999999)

for arg in "$@"; do :
  case "$arg" in
    --java-option=*)
      a="${arg#*=}"
      javaOptions+=("$a")
      ;;
    -J*)
      a="${arg#-J}"
      javaOptions+=("$a")
      ;;
    --http-port=*)
      httpPort="${arg#*=}"
      ;;
    *)
      args+=("$arg")
  esac
done

execute=(
  "$java"
  "${javaOptions[@]}"
  -classpath "$classpathString"
  -Dlog4j.configurationFile=js7/controller/client/main/log4j2.xml \
  js7.controller.client.main.ControllerClientMain
  http://127.0.0.1:$httpPort
  "${args[@]}")
exec "${execute[@]}"
