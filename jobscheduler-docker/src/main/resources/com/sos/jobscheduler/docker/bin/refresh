#!/usr/bin/env bash
set -e
bin="$(dirname -- "$0")"

[ -f build/docker-compose.yml ] || {
  echo "Call this script in directory containing subdirectory 'build'"
  exit 1
}

for f in docker-compose.yml clean-volumes testMasterAgent; do :
  [ -f "$f" ] || ln -sf "$bin/$f" .
done

mkdir -p volumes/{master,agent-1,agent-2}/config/live
mkdir -p volumes/{master,agent-1,agent-2}/data/{state,logs,tmp}

for o in $(cd build/config && ls); do
  for f in $(cd build/config/$o && find .); do
    if [ -d "build/config/$o/$f" ]; then
      [ -e "volumes/$o/config/$f" ] || mkdir "volumes/$o/config/$f"
    elif [ -f "build/config/$o/$f" ]; then
      [ -e "volumes/$o/config/$f" ] || cp -v "build/config/$o/$f" "volumes/$o/config/$f"
    fi
  done
done
