#!/usr/bin/env bash
set -e

for arg in "$@"; do :
  case "$arg" in
    *)
      echo "Invalid option: $arg"
      exit 1
      ;;
  esac
done

if [ -d build ] && [ ! -f build/bin/prepare ]; then :
  echo "Subdirectory build seems not to be created by jobscheduler-docker. Missing file build/bin/prepare. Exiting"
  exit 1
fi

rm -rf build
tar xzf jobscheduler-docker-[0-9]*.tgz
cp jobscheduler-*install-[0-9]*.tgz build/ || {
  echo "Missing installation file jobscheduler-install-x.y.tgz"
  exit 1
}
build/bin/prepare-volumes

[ -f docker-compose.yml ] || ln -sf build/docker-compose.yml .

docker-compose build
docker-compose down

echo
echo Start with: docker-compose up
