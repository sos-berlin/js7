#!/usr/bin/env bash
set -e

cd "$(cd "$(realpath "${0%/*}")"/../../build/bin/../.. && pwd)"

[ -d "volumes/testMasterAgent" ] || mkdir volumes/testMasterAgent

dir="$PWD/volumes/testMasterAgent"
rm -rf "${dir:?}"/*
docker run \
  --publish=127.0.0.1:4444:4444 \
  --publish=127.0.0.1:5000:5000 \
  --volume="$dir":/var/opt/jobscheduler/testMasterAgent \
  --rm --name=TestMasterAgent \
  -ti \
  jobscheduler \
  testMasterAgent "$@"
