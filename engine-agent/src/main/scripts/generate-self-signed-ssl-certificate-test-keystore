#! /bin/bash
# Generates a test TLS certificate
set -e

dir="$(dirname "$0")/../../../src/main/resources/com/sos/scheduler/engine/agent/test/config/private"
mkdir --parents "$dir"
cd $dir

javaKeyStore="https.jks"
rm -v --force $javaKeyStore

keytool -genkey \
  -alias test-ssl-server-certificate \
  -keyalg RSA \
  -keysize 1024 \
  -dname "CN=localhost, O=localhost, OU=Test" \
  -validity 3660 \
  -keypass "jobscheduler" \
  -storepass "jobscheduler" \
  -keystore "$javaKeyStore"

keytool -list -keystore "$javaKeyStore" -deststorepass "jobscheduler"
echo $(readlink --canonicalize $javaKeyStore)
