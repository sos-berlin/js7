define workflow {
  job TEST1, defaultArguments={"hello": "áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ!"};

  fork {
    "ğŸ¥•": {
      job TEST1, defaultArguments={"hello": "Ğ—Ğ´Ñ€Ğ°Ğ²ĞµĞ¹!"};
      job TEST1, defaultArguments={"hello": "áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ!"};
      job TEST1, defaultArguments={"hello": "Ù…Ø±Ø­Ø¨Ù‹Ø§"};
      job TEST1, defaultArguments={"hello": "ã‚„ã‚!"};
    },
    "ğŸ‹": {
      try (retryDelays=[0, 1]) {
        execute agent="agent-1", processLimit=10, executable="fail", env={"HELLO": "ã‚„ã‚"};
      } catch {
        if (tryCount < 5) {
          job SLEEP, defaultArguments={"hello": "Will try again â­•ï¸"};
          retry;
        } else
          job SLEEP, defaultArguments={"hello": "LAST JOB FAILED"};
      }
    }
  }

  job TEST2;

  // Fork with all jobs at same (current) Agent
  fork {
    "ğŸ¥•": {
      execute agent="agent-1", processLimit=10, executable="test", env={"hello": "ä½ å¥½"};
      job TEST1;
    },
    "ğŸ‹": {
      job TEST1;
      job TEST1;
    }
  }

  // Fork with one branch on current Agent, the other branch on the other Agent.
  fork {
    "ğŸ¥•": { job TEST1; job TEST1; },
    "ğŸ‹": { job TEST2; job TEST2; }
  }

  define job TEST1 {
    execute
      agent="agent-1",
      executable="test",
      processLimit=50,
      env={
        "HELLO": variable("hello", default="")
      };
  }

  define job TEST2 {
    execute
      agent="agent-2",
      processLimit=50,
      env={
        "TEST_ARGUMENT": "â˜˜ï¸"
      },
      script =
''#!/usr/bin/env bash
set -euo pipefail

echo "ã¯ã˜ã‚ã¾ã—ã¦ã€‚ $TEST_ARGUMENT"
sleep 2
exit
'';
  }

  define job SLEEP {
    execute
      agent="agent-1",
      executable="sleep",
      processLimit=10,
      env={
        "HELLO": variable("hello", default="")
      };
  }
}
